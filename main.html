<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>888bet — Triple Eight House</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --casino-bg: #0d1f0d;
      --casino-surface: #162a16;
      --casino-felt: #1a381a;
      --casino-edge: #2d5a2d;
      --gold: #d4af37;
      --gold-dim: #9a7b2a;
      --gold-bright: #f4e4a6;
      --text: #e8eed8;
      --text-dim: #8a9a7a;
      --win: #22c55e;
      --lose: #94a3b8;
      --radius: 12px;
      --font-display: "Cinzel", serif;
      --font-body: "Inter", sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-body);
      background: var(--casino-bg);
      color: var(--text);
      min-height: 100vh;
      background-image:
        radial-gradient(ellipse 120% 80% at 50% 0%, rgba(212, 175, 55, 0.08), transparent 50%),
        radial-gradient(ellipse 80% 60% at 80% 100%, rgba(34, 197, 94, 0.06), transparent);
    }

    .wrap {
      max-width: 640px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .head {
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border: 1px solid var(--casino-edge);
      border-radius: var(--radius);
      background: var(--casino-surface);
    }

    .title {
      font-family: var(--font-display);
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
    }

    .sub {
      font-size: 0.75rem;
      color: var(--text-dim);
      margin-top: 0.35rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    .card {
      background: var(--casino-felt);
      border: 1px solid var(--casino-edge);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .card h3 {
      font-family: var(--font-display);
      font-size: 0.9rem;
      color: var(--gold-dim);
      margin-bottom: 0.75rem;
      letter-spacing: 0.08em;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .row:last-child { margin-bottom: 0; }

    .label { color: var(--text-dim); }
    .value { color: var(--text); font-weight: 500; }
    .value.gold { color: var(--gold-bright); }
    .value.win { color: var(--win); }

    .connect-wrap {
      text-align: center;
      margin-bottom: 1rem;
    }

    .btn {
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 600;
      padding: 0.65rem 1.4rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: filter 0.15s, transform 0.1s;
    }

    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn:not(:disabled):hover { filter: brightness(1.1); }
    .btn:not(:disabled):active { transform: scale(0.98); }

    .btn-primary {
      background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dim) 100%);
      color: #0d1f0d;
    }

    .btn-spin {
      background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
      color: #fff;
      font-size: 1.1rem;
      padding: 0.9rem 2rem;
      width: 100%;
      margin-top: 0.75rem;
    }

    .btn-claim {
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      color: #fff;
      width: 100%;
      margin-top: 0.5rem;
    }

    .btn-ghost {
      background: transparent;
      color: var(--gold);
      border: 1px solid var(--gold-dim);
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 0.6rem 0.9rem;
      font-size: 0.9rem;
      border: 1px solid var(--casino-edge);
      border-radius: 8px;
      background: var(--casino-bg);
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    input::placeholder { color: var(--text-dim); }

    .stake-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-top: 0.5rem;
    }

    .stake-row input { flex: 1; margin-bottom: 0; }
    .stake-row .unit { color: var(--text-dim); font-size: 0.85rem; }

    .quick-stakes {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }

    .quick-stakes .btn {
      padding: 0.4rem 0.7rem;
      font-size: 0.8rem;
    }

    .reel-display {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      background: var(--casino-bg);
      border-radius: 8px;
      border: 1px solid var(--casino-edge);
    }

    .reel-symbol {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
      background: var(--casino-surface);
      border: 2px solid var(--gold-dim);
      border-radius: 8px;
    }

    .reel-symbol.tier-1 { color: #94a3b8; }
    .reel-symbol.tier-2 { color: #f59e0b; }
    .reel-symbol.tier-3 { color: var(--gold-bright); box-shadow: 0 0 12px rgba(212, 175, 55, 0.4); }

    .last-result {
      text-align: center;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .last-result.win { background: rgba(34, 197, 94, 0.15); color: var(--win); }
    .last-result.lose { background: rgba(148, 163, 184, 0.1); color: var(--lose); }
    .last-result.hidden { display: none; }

    .paused-banner {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      text-align: center;
      padding: 0.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.85rem;
    }

    .paused-banner.hidden { display: none; }

    .addr-wrap { margin-bottom: 0.75rem; }
    .addr-wrap .label { display: block; margin-bottom: 0.25rem; font-size: 0.8rem; }

    .status { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.5rem; }
    .status.err { color: #f87171; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="head">
      <h1 class="title">888</h1>
      <p class="sub">Triple Eight House — Golden Reel</p>
    </header>

    <div class="paused-banner hidden" id="pausedBanner">House is paused. Spins disabled.</div>

    <div class="connect-wrap">
      <button class="btn btn-primary" id="connectBtn">Connect wallet</button>
      <p class="status" id="status"></p>
    </div>

    <div class="card" id="walletCard" style="display: none;">
      <h3>Your wallet</h3>
      <div class="row">
        <span class="label">Address</span>
        <span class="value" id="walletAddr">—</span>
      </div>
      <div class="row">
        <span class="label">Balance</span>
        <span class="value gold" id="walletBalance">—</span>
      </div>
      <div class="row">
        <span class="label">Pending claim</span>
        <span class="value win" id="pendingClaim">—</span>
      </div>
      <button class="btn btn-claim" id="claimBtn" disabled>Claim payout</button>
    </div>

    <div class="card">
      <h3>Contract</h3>
      <div class="addr-wrap">
        <span class="label">EightEightEight address</span>
        <input type="text" id="contractAddr" placeholder="0x..." />
      </div>
    </div>

    <div class="card" id="houseCard">
      <h3>House</h3>
      <div class="row">
        <span class="label">Total spins</span>
        <span class="value" id="totalSpins">—</span>
      </div>
      <div class="row">
        <span class="label">Reserve</span>
        <span class="value gold" id="reserve">—</span>
      </div>
      <div class="row">
        <span class="label">Total staked / paid out</span>
        <span class="value" id="stakedPaid">—</span>
      </div>
    </div>

    <div class="card" id="spinCard">
      <h3>Spin</h3>
      <p class="label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Stake (ETH): min 0.001 — max 2</p>
      <div class="stake-row">
        <input type="text" id="stakeInput" placeholder="0.01" inputmode="decimal" />
        <span class="unit">ETH</span>
      </div>
      <div class="quick-stakes">
        <button type="button" class="btn btn-ghost" data-stake="0.001">0.001</button>
        <button type="button" class="btn btn-ghost" data-stake="0.01">0.01</button>
        <button type="button" class="btn btn-ghost" data-stake="0.1">0.1</button>
        <button type="button" class="btn btn-ghost" data-stake="0.5">0.5</button>
        <button type="button" class="btn btn-ghost" data-stake="1">1</button>
      </div>
      <div class="reel-display" id="reelDisplay">
        <span class="reel-symbol" id="reel1">8</span>
        <span class="reel-symbol" id="reel2">8</span>
        <span class="reel-symbol" id="reel3">8</span>
      </div>
      <div class="last-result hidden" id="lastResult"></div>
      <button class="btn btn-spin" id="spinBtn" disabled>Spin</button>
      <p class="status" id="spinStatus"></p>
    </div>
  </div>

  <script>
    (function () {
      const ABI = [
        "function spin() payable returns (uint256 spinId)",
        "function claimPayout()",
        "function getHouseState() view returns (uint256 totalSpins, uint256 totalStaked, uint256 totalPaidOut, uint256 reserveBalance)",
        "function getPendingClaim(address) view returns (uint256)",
        "function getConfig() view returns (uint256 floorWei, uint256 ceilingWei, uint256 edgeBps, uint256 vaultShareBps_, uint256 reserveMinWei, uint256 multTier1Bps, uint256 multTier2Bps, uint256 multTier3Bps, uint256 chanceTier1Bps, uint256 chanceTier2Bps, uint256 chanceTier3Bps)",
        "function isPaused() view returns (bool)",
        "function currentSpinCount() view returns (uint256)",
        "function getSpin(uint256) view returns (address player, uint256 stakeWei, uint256 placedAtBlock, uint8 tier, uint256 payoutWei, bool settled, bool claimable)",
        "event ReelStopped(uint256 indexed spinId, address indexed player, uint8 tier, uint256 payoutWei, uint256 atBlock)",
        "event ChipStaked(uint256 indexed spinId, address indexed player, uint256 amountWei, uint256 atBlock)"
      ];

      const connectBtn = document.getElementById("connectBtn");
      const statusEl = document.getElementById("status");
      const walletCard = document.getElementById("walletCard");
      const walletAddr = document.getElementById("walletAddr");
      const walletBalance = document.getElementById("walletBalance");
      const pendingClaim = document.getElementById("pendingClaim");
      const claimBtn = document.getElementById("claimBtn");
      const contractAddr = document.getElementById("contractAddr");
      const totalSpins = document.getElementById("totalSpins");
      const reserve = document.getElementById("reserve");
      const stakedPaid = document.getElementById("stakedPaid");
      const stakeInput = document.getElementById("stakeInput");
      const spinBtn = document.getElementById("spinBtn");
      const spinStatus = document.getElementById("spinStatus");
      const pausedBanner = document.getElementById("pausedBanner");
      const lastResult = document.getElementById("lastResult");
      const reel1 = document.getElementById("reel1");
      const reel2 = document.getElementById("reel2");
      const reel3 = document.getElementById("reel3");

      let provider = null;
      let signer = null;
      let userAddress = null;
      let contract = null;

      function setStatus(msg, isErr) {
